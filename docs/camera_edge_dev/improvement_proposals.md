# カメラエッジ (ESP32) 改善提案

現状の `es_cam.ino` コード解析に基づき、システムの安定性と利便性を向上させるための改善案を提案します。

## 1. 動作に必須の修正 (Critical)

### ログ機能の実装補完

コード内でプレースホルダー (`/* ... */`) となっている `elog` 名前空間の関数を実装します。これがないとコンパイルおよび動作ができません。

- `elog::tsSuffix()`
- `elog::countLines()`
- `elog::rotate()`
- `elog::appendWithRotate()`

## 2. 推奨される機能追加 (Recommended)

### NTPによる時刻同期

**現状**: 時刻同期ロジックが見当たらないため、ログのタイムスタンプが `19700101_000000` のようになり、トラブルシューティングが困難になります。
**提案**: Wi-Fi接続成功後に NTPサーバー (例: `pool.ntp.org`) から現在時刻を取得する処理を追加します。

- `configTime(9 * 3600, 0, "pool.ntp.org");` の追加

### 設定の外部化 (SDカード読み込み)

**現状**: Wi-FiのSSID/PASSやサーバーのホスト名がソースコードにハードコードされています。環境が変わるたびに書き込みが必要です。
**提案**: SDカードのルートに `config.json` を配置し、起動時に読み込むようにします。

- **メリット**: PCでSDカードを書き換えるだけで設定変更が可能になります。

## 3. さらなる安定化 (Optional)

### エラー時のバックオフ制御

**現状**: カメラ初期化やSDマウント失敗時に3秒点滅してDeep Sleepしますが、ハードウェア故障時は無限ループでバッテリーを消耗する可能性があります。
**提案**: 連続失敗回数をRTCメモリに記録し、失敗が続いた場合はSleep時間を長くする（例: 20分 -> 1時間）ロジックを追加します。

---

## 次のアクション

まずは **「1. 動作に必須の修正」** と **「2. NTPによる時刻同期」** の実装を進めることを推奨します。
設定の外部化については、開発段階ではハードコードの方がデバッグしやすい場合もあるため、任意です。
